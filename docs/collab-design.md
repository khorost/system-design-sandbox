# –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º ‚Äî –¥–∏–∑–∞–π–Ω-–¥–æ–∫—É–º–µ–Ω—Ç

## –û–±–∑–æ—Ä

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π –Ω–∞ —Å—Ö–µ–º—É –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –∞–Ω–æ–Ω–∏–º–Ω—ã–µ –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏, –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### ShareLink (—Å—Å—ã–ª–∫–∞-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ)

```
ShareLink {
  id: string                  // short code, e.g. "abc123"
  schema_id: uuid             // –∏—Å—Ö–æ–¥–Ω–∞—è —Å—Ö–µ–º–∞
  schema_version: int         // –≤–µ—Ä—Å–∏—è –Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏
  created_by: uuid            // –∫—Ç–æ —Å–æ–∑–¥–∞–ª
  name: string                // "–†–µ–≤—å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã" ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
  mode: "view" | "edit"       // –ø—Ä–∞–≤–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π
  expires_at: timestamp       // TTL, –∑–∞–¥–∞—ë—Ç—Å—è –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
  inactivity_timeout: duration // 30m | 1h | 4h | 24h
  max_participants?: int      // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

### CollabSession (—Å–µ—Å—Å–∏—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã)

–°–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –ø–æ ShareLink:

```
CollabSession {
  id: uuid
  share_link_id: string
  schema_snapshot: json       // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∏–∑ schema_id@version)
  created_at: timestamp
  is_active: bool
}
```

### CollabParticipant (—É—á–∞—Å—Ç–Ω–∏–∫ —Å–µ—Å—Å–∏–∏)

```
CollabParticipant {
  session_id: uuid
  participant_id: uuid        // –¥–ª—è reconnect-–æ–∫–Ω–∞
  user_id: uuid | null        // null = –∞–Ω–æ–Ω–∏–º–Ω—ã–π
  display_name: string        // "User 3" –¥–ª—è –∞–Ω–æ–Ω–∏–º–æ–≤
  role: "owner" | "editor" | "viewer"
  device_id: string           // –æ–¥–∏–Ω —é–∑–µ—Ä, –º–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
  connected_at: timestamp
  disconnect_at: timestamp?   // –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
  is_online: bool
}
```

### CollabDraft (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π —á–µ—Ä–Ω–æ–≤–∏–∫)

```
CollabDraft {
  session_id: uuid
  snapshot: json              // –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å—Ö–µ–º—ã
  updated_at: timestamp
  op_count: int               // —Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π —Å –Ω–∞—á–∞–ª–∞ —Å–µ—Å—Å–∏–∏
}
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

### Server-authoritative state

–í—ã–±—Ä–∞–Ω –ø–æ–¥—Ö–æ–¥ server-authoritative (–Ω–µ OT/CRDT):

1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ WebSocket
2. –°–µ—Ä–≤–µ—Ä –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∫ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
3. –°–µ—Ä–≤–µ—Ä broadcast'–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º —Å–µ—Å—Å–∏–∏
4. –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏ ‚Äî UI –∑–∞–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è –¥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—â–µ CRDT, –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é –ø—Ä–∏ –æ—Ñ–ª–∞–π–Ω–µ (freeze, –∞ –Ω–µ –º–µ—Ä–∂).

### WebSocket endpoint

–û—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ `/ws/collab?link=abc123` ‚Äî –Ω–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º `/ws/metrics`:

- **Lifecycle —Ä–∞–∑–Ω—ã–π** ‚Äî metrics –∂–∏–≤—ë—Ç –ø–æ–∫–∞ –æ—Ç–∫—Ä—ã—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, collab —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —É—á–∞—Å—Ç–∏–∏ –≤ —Å–µ—Å—Å–∏–∏
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–∑–Ω–∞—è** ‚Äî metrics = fan-out –≤—Å–µ–º, collab = fan-out –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–Ω–∞—Ç—ã (per-session rooms)
- **–ù–∞–≥—Ä—É–∑–∫–∞** ‚Äî —á–∞—Å—Ç—ã–µ ops –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî collab hub –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å/–ø–æ–¥ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç metrics
- **–ö–æ–¥** ‚Äî —Ç–µ–∫—É—â–∏–π `metrics.Hub` –Ω–µ –Ω—É–∂–Ω–æ —É—Å–ª–æ–∂–Ω—è—Ç—å –º—É–ª—å—Ç–∏–ø–ª–µ–∫—Å–∏–Ω–≥–æ–º

## –ü—Ä–æ—Ç–æ–∫–æ–ª WebSocket

### Handshake

```json
‚Üí { "type": "join", "participant_id": "optional-for-reconnect", "device_id": "xxx" }
‚Üê { "type": "welcome", "session_id": "...", "snapshot": {...},
    "participants": [...], "your_role": "editor" }
```

### –û–ø–µ—Ä–∞—Ü–∏–∏ (editor ‚Üí server ‚Üí all)

```json
‚Üí { "type": "op", "seq": 42, "op": "move_node", "data": {...} }
‚Üê { "type": "op_ack", "seq": 42 }
‚Üê { "type": "op", "from": "user:device", "op": "move_node", "data": {...} }
```

### –ü—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ

```json
‚Üê { "type": "presence", "participants": [...], "editors_count": 3, "edit_count": 17 }
```

### –ö—É—Ä—Å–æ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```json
‚Üí { "type": "cursor", "x": 150, "y": 300 }
‚Üê { "type": "cursors", "others": [{"name": "Alice", "x": 150, "y": 300, "color": "#f0f"}] }
```

### –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

```json
‚Üê { "type": "session_expiring", "in_seconds": 60 }
‚Üê { "type": "session_closed", "reason": "inactivity" }
```

## Reconnect –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞

–í `localStorage` —Ö—Ä–∞–Ω–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏—è—Ö:

```json
{
  "collab_sessions": [
    {
      "session_id": "uuid",
      "participant_id": "uuid",
      "link_id": "abc123",
      "name": "–†–µ–≤—å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã",
      "role": "editor",
      "joined_at": "...",
      "last_seen_at": "..."
    }
  ]
}
```

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

1. –ü—Ä–æ–≤–µ—Ä—è–µ–º `collab_sessions` –≤ localStorage
2. –î–ª—è –∫–∞–∂–¥–æ–π ‚Äî `GET /api/v1/collab/sessions/{id}/status` (–∂–∏–≤–∞ –ª–∏?)
3. –ï—Å–ª–∏ –∂–∏–≤–∞ ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–Ω–Ω–µ—Ä —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è
4. –ï—Å–ª–∏ –º–µ—Ä—Ç–≤–∞ ‚Äî –º–æ–ª—á–∞ —á–∏—Å—Ç–∏–º –∏–∑ localStorage

## Reconnect window (5 –º–∏–Ω—É—Ç)

–û—Ç–¥–µ–ª—å–Ω–æ –æ—Ç TTL share link ‚Äî –æ–∫–Ω–æ –¥–ª—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞:

```
–£—á–∞—Å—Ç–Ω–∏–∫ –æ—Ç–∫–ª—é—á–∏–ª—Å—è (WS closed)
  ‚Üì
–°–µ—Ä–≤–µ—Ä: participant.is_online = false
        participant.disconnect_at = now
        –ù–ï —É–¥–∞–ª—è–µ–º –∏–∑ —Å–µ—Å—Å–∏–∏
  ‚Üì
  ... –¥–æ 5 –º–∏–Ω—É—Ç ...
  ‚Üì
–ï—Å–ª–∏ reconnect (–∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç participant_id –∏–∑ localStorage):
  ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª–Ω—ã–π snapshot
  ‚Üí broadcast: "Alice reconnected"

–ï—Å–ª–∏ 5 –º–∏–Ω –∏—Å—Ç–µ–∫–ª–∏:
  ‚Üí —É–¥–∞–ª—è–µ–º participant
  ‚Üí broadcast: "Alice left"
```

## –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞

–ß–µ—Ä–µ–∑ `BroadcastChannel` (—É–∂–µ –µ—Å—Ç—å –¥–ª—è auth sync):

1. –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: `{ type: "collab_discovery" }`
2. –í–∫–ª–∞–¥–∫–∞ —Å –∞–∫—Ç–∏–≤–Ω–æ–π collab-—Å–µ—Å—Å–∏–µ–π –æ—Ç–≤–µ—á–∞–µ—Ç: `{ type: "collab_active", session_id, name, role }`
3. –ù–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ö–∞–∂–¥–∞—è –≤–∫–ª–∞–¥–∫–∞ ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π WS, —Å–≤–æ–π `device_id`. –°–µ—Ä–≤–µ—Ä –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ `user_id`.

## –û–¥–∏–Ω —é–∑–µ—Ä ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

`device_id` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ (localStorage). –°–µ—Ä–≤–µ—Ä –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:

```json
{
  "participants": [
    { "user": "Alice", "devices": 2, "role": "owner" },
    { "user": "Bob", "devices": 1, "role": "editor" },
    { "user": null, "display_name": "Guest 1", "devices": 1, "role": "viewer" }
  ]
}
```

–í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –æ–¥–Ω–æ–≥–æ —é–∑–µ—Ä–∞ –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π broadcast. –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ—Ç ‚Äî —Å–µ—Ä–≤–µ—Ä sequential.

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–≤—è–∑–∏

```
–°–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞:

  CONNECTED     ‚Üí –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞
  RECONNECTING  ‚Üí freeze UI, –æ–≤–µ—Ä–ª–µ–π "Reconnecting..."
  DISCONNECTED  ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –≤—ã–±–æ—Ä:
                    [–ñ–¥–∞—Ç—å] ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—ã—Ç–∞—Ç—å—Å—è
                    [–†–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ] ‚Üí –∫–æ–ø–∏—Ä—É–µ—Ç snapshot,
                      –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç —Å–µ—Å—Å–∏–∏, —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ
```

–ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏:
1. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π `snapshot` (–Ω–µ diff)
2. –ö–ª–∏–µ–Ω—Ç –∑–∞–º–µ–Ω—è–µ—Ç state —Ü–µ–ª–∏–∫–æ–º
3. UI —Ä–∞–∑–º–æ—Ä–∞–∂–∏–≤–∞–µ—Ç—Å—è

–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø: –≤ –º—É–ª—å—Ç–∏–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å–µ—Å—Å–∏–∏ –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –æ—Ñ–ª–∞–π–Ω–µ, —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π. –Ø–≤–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ ("–†–∞–±–æ—Ç–∞—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω–æ") —Å–æ–∑–¥–∞—ë—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –∫–æ–ø–∏—é.

## Inactivity timeout

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞—Ç–æ—Ä–æ–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Å—ã–ª–∫–∏ (30m, 1h, 4h, 24h):

```
–ü–æ—Å–ª–µ–¥–Ω—è—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç –ª—é–±–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
  ‚Üì
  ... —Ç–∏—à–∏–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ inactivity_timeout ...
  ‚Üì
–°–µ—Ä–≤–µ—Ä ‚Üí –≤—Å–µ–º: { type: "session_expiring", in_seconds: 60 }
  ‚Üì
UI: "–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 60—Å ‚Äî –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"
    [–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å] ‚Äî –ª—é–±–æ–π editor –∫–ª–∏–∫–∞–µ—Ç, —Ç–∞–π–º–µ—Ä —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
    [–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–ø–∏—é] ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ —Å–≤–æ–π workspace
  ‚Üì
  ... 60—Å –±–µ–∑ "–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å" ...
  ‚Üì
–°–µ—Ä–≤–µ—Ä: session.is_active = false
        ‚Üí –≤—Å–µ–º: { type: "session_closed", reason: "inactivity" }
        ‚Üí –≤—Å–µ WS –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è
–ö–ª–∏–µ–Ω—Ç—ã: —Å—Ö–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ –≤ offline-—Ä–µ–∂–∏–º–µ
         –ø–æ–∫–∞–∑—ã–≤–∞–µ–º: [–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –º–æ–π workspace]
```

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ

### –Ø–≤–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (–∫–Ω–æ–ø–∫–∞ "Save")

–õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –º–æ–∂–µ—Ç –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É –≤ —Å–≤–æ–π workspace:

```
POST /api/v1/architectures
{
  "name": "My copy",
  "data": { ... },              // —Ç–µ–∫—É—â–∏–π snapshot
  "forked_from": {              // lineage
    "schema_id": "uuid",
    "schema_version": 3
  }
}
```

–°–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å—Ö–µ–º—É —Å `forked_from` –¥–ª—è traceability.

### –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ (–∞–≤—Ç–æ—Å–µ–π–≤)

–°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç draft:
- –ö–∞–∂–¥—ã–µ **30 —Å–µ–∫—É–Ω–¥** –µ—Å–ª–∏ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (debounce)
- –ü—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
- –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–µ—Å—Å–∏–∏ –ø–æ inactivity

Draft –∂–∏–≤—ë—Ç **7 –¥–Ω–µ–π** –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏. –ò–Ω–∏—Ü–∏–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –µ–≥–æ –≤ "–ú–æ–∏ —Å–µ—Å—Å–∏–∏ ‚Üí –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ" –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∏–ª–∏ –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å (–∞–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 7–¥).

### –°—Ö–µ–º–∞: —á–µ—Ä–Ω–æ–≤–∏–∫ vs –≤–µ—Ä—Å–∏—è

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   Collab Session     ‚îÇ
                    ‚îÇ   (live editing)     ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ       ‚îÇ
              –∫–∞–∂–¥—ã–µ 30—Å  ‚îÇ       ‚îÇ  –∫–Ω–æ–ø–∫–∞ "Save"
                          ‚ñº       ‚ñº
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇDraft ‚îÇ  ‚îÇ New version   ‚îÇ
                    ‚îÇ(temp)‚îÇ  ‚îÇ (permanent)   ‚îÇ
                    ‚îÇ 7–¥   ‚îÇ  ‚îÇ forked_from:  ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ   schema@v3   ‚îÇ
                              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## UI –∏–Ω–¥–∏–∫–∞—Ü–∏—è

–°—Ç–∞—Ç—É—Å-–±–∞—Ä –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π collab-—Å–µ—Å—Å–∏–∏:

```
[üü¢ Live] 4 participants (2 editing) ¬∑ 23 changes ¬∑ "–†–µ–≤—å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã" ¬∑ [Save copy] [Leave]
```

- –ó–µ–ª—ë–Ω—ã–π / –∂—ë–ª—Ç—ã–π / –∫—Ä–∞—Å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä ‚Äî online / reconnecting / disconnected
- –ê–≤–∞—Ç–∞—Ä–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (Gravatar –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö, —Ü–≤–µ—Ç–Ω—ã–µ –∫—Ä—É–∂–∫–∏ –¥–ª—è –∞–Ω–æ–Ω–∏–º–æ–≤)
- –°—á—ë—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞ —Å–µ—Å—Å–∏—é
- –ö—É—Ä—Å–æ—Ä—ã –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ (—Ü–≤–µ—Ç = —É—á–∞—Å—Ç–Ω–∏–∫)

## –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

```
–°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ ‚Üí –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Üí –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞
    ‚Üì                                          ‚Üì
  [TTL —Å—Å—ã–ª–∫–∏]                          [drafts –∫–∞–∂–¥—ã–µ 30—Å]
                                               ‚Üì
                              Inactivity timeout / –≤—Å–µ —É—à–ª–∏
                                               ‚Üì
                                    –°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞
                                               ‚Üì
                                  Draft –∂–∏–≤—ë—Ç 7 –¥–Ω–µ–π
                                               ‚Üì
                                    –ê–≤—Ç–æ-—É–¥–∞–ª–µ–Ω–∏–µ
```

## –§–∞–∑—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

| –§–∞–∑–∞ | –ß—Ç–æ | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|------|-----|-----------|
| 1 | ShareLink CRUD + join –ø–æ —Å—Å—ã–ª–∫–µ (view-only) | –°—Ä–µ–¥–Ω—è—è |
| 2 | WebSocket collab hub + broadcast ops (edit mode) | –í—ã—Å–æ–∫–∞—è |
| 3 | Freeze/reconnect + "detach to local copy" | –°—Ä–µ–¥–Ω—è—è |
| 4 | Multi-device (device_id) + presence UI | –ù–∏–∑–∫–∞—è |
| 5 | –ö—É—Ä—Å–æ—Ä—ã –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –∫–∞–Ω–≤–∞—Å–µ | –ù–∏–∑–∫–∞—è |
