version: "3.8"

# Production: по умолчанию :stable (push в main), можно указать конкретную версию через IMAGE_TAG
# Обновление: docker compose -f docker-compose.prod.yml pull && docker compose -f docker-compose.prod.yml up -d
# Конкретная версия: IMAGE_TAG=0.2.0 docker compose -f docker-compose.prod.yml up -d

services:
  web:
    image: khorost/sdsandbox-web:${IMAGE_TAG:-stable}
    container_name: sdsandbox-web
    restart: unless-stopped
    ports:
      - "3000:80"

  server:
    image: khorost/sdsandbox-server:${IMAGE_TAG:-stable}
    container_name: sdsandbox-server
    restart: unless-stopped
    ports:
      - "4000:8080"
    environment:
      - DATABASE_URL=${DATABASE_URL}
      - REDIS_URL=${REDIS_URL}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_DB=${REDIS_DB:-0}
      - REDIS_SENTINEL_ACTIVE=${REDIS_SENTINEL_ACTIVE:-false}
      - REDIS_SENTINEL_MASTER=${REDIS_SENTINEL_MASTER}
      - REDIS_SENTINEL_URL=${REDIS_SENTINEL_URL}
